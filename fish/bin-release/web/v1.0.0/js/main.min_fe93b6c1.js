var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(n,s){function a(t){try{h(r.next(t))}catch(e){s(e)}}function o(t){try{h(r["throw"](t))}catch(e){s(e)}}function h(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(a,o)}h((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return r([t,e])}}function r(i){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,s&&(a=s[2&i[0]?"return":i[0]?"throw":"next"])&&!(a=a.call(s,i[1])).done)return a;switch(s=0,a&&(i=[0,a.value]),i[0]){case 0:case 1:a=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,s=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(a=h.trys,!(a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){h.label=i[1];break}if(6===i[0]&&h.label<a[1]){h.label=a[1],a=i;break}if(a&&h.label<a[2]){h.label=a[2],h.ops.push(i);break}a[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(r){i=[6,r],s=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,s,a,o,h={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e.skinName="resource/skins/loading.exml",e}return __extends(e,t),e.prototype.createView=function(){},e.prototype.onProgress=function(t,e){this.loading.width=t/e*428},e}(eui.Component);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function r(r){e.call(i,r,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?r(n):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Btn=function(t){function e(){var e=t.call(this)||this;return e.render(),e}return __extends(e,t),e.prototype.render=function(){this.shp=new egret.Shape,this.shp.graphics.beginFill(16711680,1),this.shp.graphics.drawRect(0,0,100,200),this.shp.graphics.endFill(),this.width=100,this.height=200,this.x=0,this.y=0,this.addChild(this.shp)},e}(egret.DisplayObjectContainer);__reflect(Btn.prototype,"Btn");var Fish=function(t){function e(e,i,r,n){var s=t.call(this)||this;return s.gravity=0,s.velX=0,s.velY=0,s.velZ=0,s.counter=0,s.TO_RADIANS=Math.PI/180,s.size=1,s.enabled=!0,s.posX=e,s.posY=i,s.posZ=r,s.fishBitmap=n,s.addChild(n),s}return __extends(e,t),e.prototype.render=function(){var t=.04*Math.sin(.4*this.counter)+this.size,e=.04*Math.sin(Math.PI+.4*this.counter)+this.size;this.x=this.posX,this.y=this.posY,this.scaleX=t,this.scaleY=e},e.prototype.update=function(){this.velY+=this.gravity,this.posX+=this.velX,this.posY+=this.velY,this.posZ+=this.velZ,this.counter++,this.rotate(2)},e.prototype.rotate=function(t,e){var i=Math.cos(t*(e?1:this.TO_RADIANS)),r=Math.sin(t*(e?1:this.TO_RADIANS)),n=this.stage.stageWidth/2,s=this.posX-n;this.posX=s*i-this.posZ*r+n,this.posZ=s*r+this.posZ*i,s=this.velX,this.velX=s*i-this.velZ*r,this.velZ=s*r+this.velZ*i},e}(egret.DisplayObjectContainer);__reflect(Fish.prototype,"Fish");var FishEmitter=function(t){function e(){var e=t.call(this)||this;return e.particles=[],e.spareParticles=[],e}return __extends(e,t),e.prototype.update=function(){for(var t=0;t<this.particles.length;t++){var e=this.particles[t];e.enabled&&(e.update(),e.enabled||this.removeParticle(e))}},e.prototype.removeParticle=function(t){this.removeChild(t),t.enabled=!1,this.spareParticles.push(t)},e.prototype.makeParticle=function(){var t;return this.spareParticles.length>0?(t=this.spareParticles.shift(),this.addChild(t)):(t=new FishParticle,this.particles.push(t),this.addChild(t)),t.enabled=!0,t},e.prototype.makeExplosion=function(t,e){for(var i=0;30>i;i++){var r=this.makeParticle();r.x=t,r.y=e,r.xVel=Math.random()-.5,r.yVel=Math.random()-.5,r.zVel=Math.random()-.5;var n=Math.sqrt(r.xVel*r.xVel+r.yVel*r.yVel+r.zVel*r.zVel);r.xVel*=40/n,r.yVel*=40/n,r.zVel*=40/n,r.size=1.5,r.update()}},e}(egret.DisplayObjectContainer);__reflect(FishEmitter.prototype,"FishEmitter");var FishParticle=function(t){function e(){var e=t.call(this)||this;return e.xVel=0,e.yVel=0,e.size=1,e.enabled=!0,e.render(),e}return __extends(e,t),e.prototype.render=function(){var t=this.createBitmapByName("orangeParticle_png");this.width=32,this.height=32,this.addChild(t)},e.prototype.update=function(){var t=.84;this.xVel*=t,this.yVel*=t,this.x+=this.xVel,this.y+=this.yVel,this.size*=.9,this.scaleX=this.size,this.scaleY=this.size,this.size<.05&&(this.enabled=!1)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e.name=t,e},e}(egret.DisplayObjectContainer);__reflect(FishParticle.prototype,"FishParticle");var BgMap=function(t){function e(){var e=t.call(this)||this;return e.timeOnEnterFrame=0,e.bgSpeed=.5,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this);var t=this.stage.stageWidth,e=this.stage.stageHeight;this.textureHeight=e,this.rowCount=Math.ceil(e/this.textureHeight)+1,this.bmpParallaxBackArr=[],this.bmpParallaxFrontArr=[];for(var i=0;i<this.rowCount;i+=1){var r=this.createBitmapByName("parallaxBack_jpg");r.y=this.textureHeight*i-(this.textureHeight*this.rowCount-e),r.width=t,r.height=e,this.bmpParallaxBackArr.push(r),this.addChild(r)}for(var i=0;i<this.rowCount;i+=1){var n=this.createBitmapByName("parallaxFront_png");n.y=this.textureHeight*i-(this.textureHeight*this.rowCount-e),n.width=t,n.height=e,this.bmpParallaxFrontArr.push(n),this.addChild(n)}this.timeOnEnterFrame=egret.getTimer()},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e.name=t,e},e.prototype.start=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this),this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},e.prototype.pause=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},e.prototype.enterFrameHandler=function(t){for(var e=egret.getTimer(),i=e-this.timeOnEnterFrame,r=0;r<this.rowCount;r+=1){var n=this.bmpParallaxFrontArr[r];n.y+=2*this.bgSpeed*i,n.y>this.stage.stageHeight&&(n.y=this.bmpParallaxFrontArr[0].y-this.textureHeight,this.bmpParallaxFrontArr.pop(),this.bmpParallaxFrontArr.unshift(n));var s=this.bmpParallaxBackArr[r];s.y+=this.bgSpeed*i,s.y>this.stage.stageHeight&&(s.y=this.bmpParallaxBackArr[0].y-this.textureHeight,this.bmpParallaxBackArr.pop(),this.bmpParallaxBackArr.unshift(s))}this.timeOnEnterFrame=e},e}(egret.DisplayObjectContainer);__reflect(BgMap.prototype,"BgMap");var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.counter=0,e.delFish=0,e.time=1e3,e.timeNum=20,e.timeTxtNum=0,e.spareFishes=[],e.fishes=[],e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,5,,6]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("loading",1)];case 3:return i.sent(),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadGroup("preload",0,t)];case 4:return i.sent(),this.stage.removeChild(t),[3,6];case 5:return e=i.sent(),console.error(e),[3,6];case 6:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var r=new eui.Theme("resource/default.thm.json",t.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){this.bg=new BgMap,this.addChild(this.bg),this.emitter=new FishEmitter,this.addChild(this.emitter),this.scorePanel=new ScorePanel,this.scorePanel.touchEnabled=!0,this.scorePanel.x=0,this.scorePanel.y=100,this.scorePanel.showStart(),this.scorePanel.addEventListener(CustomHandleEvent.GameStart,this.gameStart,this),this.addChild(this.scorePanel),this.timerS(),this.timerTxt(),this.bg.start()},e.prototype.timerTxt=function(){this.txt=new egret.TextField,this.txt.width=70,this.txt.height=50,this.txt.textAlign="center",this.txt.textColor=16777215,this.txt.size=30,this.txt.y=20,this.txt.x=20,this.addChild(this.txt)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.timerS=function(){this.timer=new egret.Timer(this.time,this.timeNum),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this)},e.prototype.timerFunc=function(){this.txt.text=--this.timeTxtNum+"S",console.log(egret.getTimer())},e.prototype.timerComFunc=function(){this.gameEnd()},e.prototype.gameStart=function(){this.clearFish(),this.timeTxtNum=this.timeNum,this.txt.text=this.timeTxtNum+"S",this.timer.reset(),this.timer.start();try{this.removeChild(this.scorePanel)}catch(t){}this.addEventListener(egret.Event.ENTER_FRAME,this.onGameLoop,this)},e.prototype.gameEnd=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.onGameLoop,this),this.scorePanel.showScore(this.delFish),this.addChild(this.scorePanel)},e.prototype.onGameLoop=function(){this.counter++%10==0&&this.makeFish();for(var t=0;t<this.fishes.length;t++){var e=this.fishes[t];e.enabled&&(e.update(),e.render(),e.posY<-200&&this.removeFish(e))}this.emitter.update()},e.prototype.makeFish=function(){var t;if(this.spareFishes.length)t=this.spareFishes.pop(),t.enabled=!0,this.addChild(t);else{var e=this.createBitmapByName("orangefish0"+(this.fishes.length%4+1)+"_png");t=new Fish(0,0,0,e),this.fishes.push(t),t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.explodeFish,this),t.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.explodeFish,this),this.addChild(t)}var i=this.stage.stageWidth/2;t.posX=i+this.randomRange(-250,250),t.posY=this.stage.stageHeight+10,t.posZ=this.randomRange(-250,250),t.velX=this.randomRange(-1,1),t.velY=this.randomRange(-1,-2),t.velZ=this.randomRange(-1,1),t.size=1,t.gravity=-.3},e.prototype.explodeFish=function(t){var e=t.target;this.emitter.makeExplosion(e.posX,e.posY),this.removeFish(e),this.delFish++},e.prototype.removeFish=function(t){t.enabled=!1,this.removeChild(t),this.spareFishes.push(t)},e.prototype.clearFish=function(){var t=this;this.delFish=0,this.counter=0,this.spareFishes=[],this.fishes.map(function(e){try{t.removeChild(e)}catch(i){}}),this.fishes=[]},e.prototype.randomRange=function(t,e){return Math.random()*(e-t)+t},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ScorePanel=function(t){function e(){var e=t.call(this)||this;return e.originNum=30,e.render(),e}return __extends(e,t),e.prototype.render=function(){this.tipView=new TipView,this.addChild(this.tipView),this.gameStartEvent=new CustomHandleEvent(CustomHandleEvent.GameStart),this.tipView.addEventListener(CustomHandleEvent.CompleteAnimation,this.gameStartHandle,this)},e.prototype.showScore=function(t){var e="";t<this.originNum&&(e="很遗憾，未达到目标！\n"),this.tipView.setText("您的成绩是："+t+"条\n\n"+e+"\n点击开始再来一次吧")},e.prototype.showStart=function(){this.tipView.setText("游戏开始后请刺破"+this.originNum+"条泡泡鱼\n\n点击开始吧")},e.prototype.gameStartHandle=function(){console.log("按钮动画结束了"),this.dispatchEvent(this.gameStartEvent)},e}(egret.Sprite);__reflect(ScorePanel.prototype,"ScorePanel");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,r){function n(t){e.call(r,t)}function s(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),i.call(r))}var a=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(r,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var o=t.split("/");o.pop();var h=o.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(r,generateJSON.paths[t])},this):RES.getResByUrl(h,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){e.call(r,generateJSON.paths[t])},a)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var TipView=function(t){function e(){var e=t.call(this)||this;return e.isClick=!1,e.skinName="resource/skins/tip.exml",e.text.textAlign="center",e.text.textColor=16777215,e.text.size=24,e.text.y=100,e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=this,e=new CustomHandleEvent(CustomHandleEvent.CompleteAnimation);this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.start.play(0)},this),this.start.addEventListener("complete",function(){t.dispatchEvent(e)},this)},e.prototype.setText=function(t){this.text.text=t},e}(eui.Component);__reflect(TipView.prototype,"TipView");var CustomHandleEvent=function(t){function e(e,i,r){return void 0===i&&(i=!1),void 0===r&&(r=!1),t.call(this,e,i,r)||this}return __extends(e,t),e.GameStart="游戏开始",e.CompleteAnimation="按钮动画结束",e}(egret.Event);__reflect(CustomHandleEvent.prototype,"CustomHandleEvent");