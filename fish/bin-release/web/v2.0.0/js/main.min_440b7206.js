var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(s,r){function o(t){try{h(n.next(t))}catch(e){r(e)}}function a(t){try{h(n["throw"](t))}catch(e){r(e)}}function h(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(o,a)}h((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(s)throw new TypeError("Generator is already executing.");for(;h;)try{if(s=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,r=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(o=h.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){h.label=i[1];break}if(6===i[0]&&h.label<o[1]){h.label=o[1],o=i;break}if(o&&h.label<o[2]){h.label=o[2],h.ops.push(i);break}o[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(n){i=[6,n],r=0}finally{s=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var s,r,o,a,h={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},LevelGroup=function(t){function e(e,i){void 0===e&&(e=9),void 0===i&&(i=[1]);var n=t.call(this)||this;return n.levels=[],n.levelNum=9,n.unlock=[1],n.rowNum=3,n.levelNum=e,n.unlock=i,n.myGroup=new eui.Group,n.game=new Game,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.render,n),n.game.addEventListener(CustomHandleEvent.ReturnLevel,n.returnLevel,n),n.game.addEventListener(CustomHandleEvent.UpdateLevel,n.updateLevel,n),n}return __extends(e,t),e.prototype.updateLevel=function(t){this.unlockLevel(t.levelNum)},e.prototype.returnLevel=function(){this.addChild(this.myGroup),this.addChild(this.txt),this.removeChild(this.game)},e.prototype.textField=function(){this.txt=new egret.TextField,this.txt.width=this.stage.stageWidth,this.txt.height=200,this.txt.textAlign="center",this.txt.textColor=16777215,this.txt.size=40,this.txt.y=0,this.txt.text="关卡选择",this.addChild(this.txt)},e.prototype.render=function(){this.textField(),this.tLayout();for(var t=0;t<this.levelNum;t+=1){var e=void 0,i=t+1;this.unlock.indexOf(i)>-1?(e=new Level(!1,i),e.addEventListener(CustomHandleEvent.ChoiceLevel,this.gameStartHandle,this)):e=new Level(!0,i),this.levels.push(e),this.myGroup.addChild(e)}this.addChild(this.myGroup)},e.prototype.tLayout=function(){this.myGroup.width=this.stage.stageWidth,this.myGroup.height=400;var t=new eui.TileLayout;t.horizontalGap=0,t.verticalGap=0,t.columnAlign=eui.ColumnAlign.JUSTIFY_USING_WIDTH,t.rowAlign=eui.RowAlign.JUSTIFY_USING_HEIGHT,t.horizontalAlign=egret.HorizontalAlign.CENTER,t.paddingTop=0,t.paddingRight=0,t.paddingLeft=0,t.paddingBottom=10,t.requestedColumnCount=this.rowNum,this.myGroup.layout=t,this.myGroup.y=80},e.prototype.unlockLevel=function(t){var e=this;-1===this.unlock.indexOf(t)&&this.unlock.push(t),this.levels.map(function(t,i){e.unlock.indexOf(i+1)>-1&&t.isLock&&(t.isLock=!1,t.number=i+1,t.render(),t.addEventListener(CustomHandleEvent.ChoiceLevel,e.gameStartHandle,e))})},e.prototype.gameStartHandle=function(t){this.game.levelChange(t.levelNum),this.removeChild(this.myGroup),this.removeChild(this.txt),this.addChild(this.game)},e}(egret.DisplayObjectContainer);__reflect(LevelGroup.prototype,"LevelGroup");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var s=RES.getRes(t);s?n(s):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Bomb=function(t){function e(){var e=t.call(this)||this;return e.k=!0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){this.bompImg1=this.createBitmapByName("bomp_1_png"),this.bompImg2=this.createBitmapByName("bomp_2_png"),this.bompImg1.width=40,this.bompImg2.width=40,this.bompImg1.height=40,this.bompImg2.height=40,this.addChild(this.bompImg1),this.addChild(this.bompImg2),this.addBomb()},e.prototype.addBomb=function(){var t=this;this.k=!this.k,setTimeout(function(){t.k?(t.bompImg1.visible=!1,t.bompImg2.visible=!0):(t.bompImg1.visible=!0,t.bompImg2.visible=!1),t.addBomb()},500)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e.name=t,e},e}(egret.DisplayObjectContainer);__reflect(Bomb.prototype,"Bomb");var BombMap=function(t){function e(e){var i=t.call(this)||this;return i.map=e,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i}return __extends(e,t),e.prototype.onAddToStage=function(){var t=this;console.log("BombMap success");var e=this.map._childrens||[];e.map(function(e,i){var n=e.attributes,s=new Bomb;s.x=n.x,s.y=n.y-40,t.addChild(s)})},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e.name=t,e},e}(egret.DisplayObjectContainer);__reflect(BombMap.prototype,"BombMap");var Bullet=function(t){function e(e,i){var n=t.call(this,e)||this;return n.textureName=i,n}return __extends(e,t),e.make=function(t){this.cachePool[t]||(this.cachePool[t]=[]);var i,n=this.cachePool[t];return i=n.length?n.pop():new e(RES.getRes(t),t)},e.reclaim=function(t,e){this.cachePool[e]||(this.cachePool[e]=[]);var i=this.cachePool[e];-1===i.indexOf(t)&&i.push(t)},e.cachePool={},e}(egret.Bitmap);__reflect(Bullet.prototype,"Bullet");var Enemy=function(t){function e(){var e=t.call(this)||this;return e.gravity=0,e.velX=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){var t=this.createBitmapByName("bomp_3_png");t.width=40,t.height=40,t.rotation=0,this.addChild(t)},e.prototype.render=function(){this.x=this.posX},e.prototype.update=function(){this.velX+=this.gravity,this.posX+=this.velX},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e.name=t,e},e}(egret.DisplayObjectContainer);__reflect(Enemy.prototype,"Enemy");var EnemyMap=function(t){function e(e){var i=t.call(this)||this;return i.map=e,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i}return __extends(e,t),e.prototype.onAddToStage=function(){this.enemyFish=new Enemy,this.enemyFish.x=40,this.enemyFish.y=120,this.addChild(this.enemyFish),this.matrixs=this.matrixMap(),this.grid=new PF.Grid(this.matrixs[0].length,this.matrixs.length,this.matrixs)},e.prototype.setTarget=function(t,e){var i=Math.ceil(t/40),n=Math.ceil(e/40),s=Math.ceil(this.enemyFish.x/40),r=Math.ceil(this.enemyFish.y/40),o=this.findPath(s,r,i,n)||[];this.animation(o)},e.prototype.animation=function(t){var e=this,i=egret.Tween.get(this.enemyFish),n=t.length,s=1,r=function(){i.to({x:40*t[s][0],y:40*t[s][1]},500,egret.Ease.quartInOut).call(function(){s++,s>=n?e.checked():r()})};n>s&&r()},e.prototype.checked=function(){},e.prototype.matrixMap=function(){for(var t=this.map.getChildByName("enemyLoad").layerData,e=[],i=0;i<t[0].length;i++)e.push([]);for(var n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++){var s=e[i];t[n][i]?s.push(0):s.push(1)}return e},e.prototype.findPath=function(t,e,i,n){var s=[],r=this.grid.clone(),o=new PF.AStarFinder,a=o.findPath(t,e,i,n,r);return a.length&&(s=PF.Util.smoothenPath(r,a)),s},e}(egret.DisplayObjectContainer);__reflect(EnemyMap.prototype,"EnemyMap");var Fish=function(t){function e(e,i,n,s){var r=t.call(this)||this;return r.gravity=0,r.velX=0,r.velY=0,r.velZ=0,r.counter=0,r.TO_RADIANS=Math.PI/180,r.size=1,r.enabled=!0,r.posX=e,r.posY=i,r.posZ=n,r.fishBitmap=s,r.addChild(s),r}return __extends(e,t),e.prototype.render=function(){var t=.04*Math.sin(.4*this.counter)+this.size,e=.04*Math.sin(Math.PI+.4*this.counter)+this.size;this.x=this.posX,this.y=this.posY,this.scaleX=t,this.scaleY=e},e.prototype.update=function(){this.velY+=this.gravity,this.posX+=this.velX,this.posY+=this.velY,this.posZ+=this.velZ,this.counter++,this.rotate(2)},e.prototype.rotate=function(t,e){var i=Math.cos(t*(e?1:this.TO_RADIANS)),n=Math.sin(t*(e?1:this.TO_RADIANS)),s=this.stage.stageWidth/2,r=this.posX-s;this.posX=r*i-this.posZ*n+s,this.posZ=r*n+this.posZ*i,r=this.velX,this.velX=r*i-this.velZ*n,this.velZ=r*n+this.velZ*i},e}(egret.DisplayObjectContainer);__reflect(Fish.prototype,"Fish");var FishEmitter=function(t){function e(){var e=t.call(this)||this;return e.particles=[],e.spareParticles=[],e}return __extends(e,t),e.prototype.update=function(){for(var t=0;t<this.particles.length;t++){var e=this.particles[t];e.enabled&&(e.update(),e.enabled||this.removeParticle(e))}},e.prototype.removeParticle=function(t){this.removeChild(t),t.enabled=!1,this.spareParticles.push(t)},e.prototype.makeParticle=function(){var t;return this.spareParticles.length>0?(t=this.spareParticles.shift(),this.addChild(t)):(t=new FishParticle,this.particles.push(t),this.addChild(t)),t.enabled=!0,t},e.prototype.makeExplosion=function(t,e){for(var i=0;30>i;i++){var n=this.makeParticle();n.x=t,n.y=e,n.xVel=Math.random()-.5,n.yVel=Math.random()-.5,n.zVel=Math.random()-.5;var s=Math.sqrt(n.xVel*n.xVel+n.yVel*n.yVel+n.zVel*n.zVel);n.xVel*=40/s,n.yVel*=40/s,n.zVel*=40/s,n.size=1.5,n.update()}},e.prototype.clearAll=function(){var t=this;this.particles.map(function(e){e.enabled&&t.removeParticle(e)})},e}(egret.DisplayObjectContainer);__reflect(FishEmitter.prototype,"FishEmitter");var FishMap=function(t){function e(e){var i=t.call(this)||this;return i.map=e,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i}return __extends(e,t),e.prototype.onAddToStage=function(){this.enemyFish=new Enemy,this.enemyFish.x=40,this.enemyFish.y=120,this.addChild(this.enemyFish),this.matrixs=this.matrixMap(),this.grid=new PF.Grid(this.matrixs[0].length,this.matrixs.length,this.matrixs)},e.prototype.setTarget=function(t,e){var i=Math.ceil(t/40),n=Math.ceil(e/40),s=Math.ceil(this.enemyFish.x/40),r=Math.ceil(this.enemyFish.y/40),o=this.findPath(s,r,i,n)||[];this.animation(o)},e.prototype.animation=function(t){var e=this,i=egret.Tween.get(this.enemyFish),n=t.length,s=1,r=function(){i.to({x:40*t[s][0],y:40*t[s][1]},500,egret.Ease.quartInOut).call(function(){s++,s>=n?e.checked():r()})};n>s&&r()},e.prototype.checked=function(){},e.prototype.matrixMap=function(){for(var t=this.map.getChildByName("fishLoad").layerData,e=[],i=0;i<t[0].length;i++)e.push([]);for(var n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++){var s=e[i];t[n][i]?s.push(0):s.push(1)}return e},e.prototype.findPath=function(t,e,i,n){var s=[],r=this.grid.clone(),o=new PF.AStarFinder,a=o.findPath(t,e,i,n,r);return a.length&&(s=PF.Util.smoothenPath(r,a)),s},e}(egret.DisplayObjectContainer);__reflect(FishMap.prototype,"FishMap");var FishParticle=function(t){function e(){var e=t.call(this)||this;return e.xVel=0,e.yVel=0,e.size=1,e.enabled=!0,e.render(),e}return __extends(e,t),e.prototype.render=function(){var t=this.createBitmapByName("orangeParticle_png");this.width=32,this.height=32,this.addChild(t)},e.prototype.update=function(){var t=.84;this.xVel*=t,this.yVel*=t,this.x+=this.xVel,this.y+=this.yVel,this.size*=.9,this.scaleX=this.size,this.scaleY=this.size,this.size<.05&&(this.enabled=!1)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e.name=t,e},e}(egret.DisplayObjectContainer);__reflect(FishParticle.prototype,"FishParticle");var Game=function(t){function e(){var e=t.call(this)||this;return e.time=1e3,e.timeNum=20,e.counter=0,e.frequencyFish=8,e.delFish=0,e.spareFishes=[],e.fishes=[],e.level=1,e.gravity=-.2,e.originNum=30,e.render(),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onCreateBannerAd,e),e}return __extends(e,t),e.prototype.onCreateBannerAd=function(){try{this.bannerAd&&this.bannerAd.destroy(),this.bannerAd=wx.createBannerAd({adUnitId:"adunit-e808c74164a5538a",style:{left:0,top:this.stage.stageHeight/2-50,width:this.stage.stageWidth,height:120}}),this.bannerAd.onError(function(t){})}catch(t){console.log(t)}},e.prototype.levelChange=function(t){void 0===t&&(t=1),this.level=t,this.timeNum=20,this.gravity=-.2,this.timeNum=this.timeNum-(this.level-1),this.gravity=this.gravity+-this.level/10,this.scorePanel.setOriginNum(29+this.level),this.scorePanel.showStart(),this.timer.repeatCount=this.timeNum},e.prototype.render=function(){this.fishEmitter=new FishEmitter,this.addChild(this.fishEmitter),this.pannelUI(),this.gameTimer(),this.TxtTimer()},e.prototype.pannelUI=function(){this.scorePanel=new ScorePanel,this.scorePanel.touchEnabled=!0,this.scorePanel.x=0,this.scorePanel.y=100,this.addChild(this.scorePanel),this.scorePanel.addEventListener(CustomHandleEvent.GameStart,this.gameStart,this),this.scorePanel.addEventListener(CustomHandleEvent.ReturnLevel,this.returnLevel,this),this.scorePanel.addEventListener(CustomHandleEvent.UpdateLevel,this.updateLevel,this),this.scorePanel.addEventListener(CustomHandleEvent.NextLevel,this.nextLevel,this)},e.prototype.updateLevel=function(){var t=new CustomHandleEvent(CustomHandleEvent.UpdateLevel);t.levelNum=this.level+1,console.log("发起更新通关关卡",this.level+1),this.dispatchEvent(t)},e.prototype.returnLevel=function(){var t=new CustomHandleEvent(CustomHandleEvent.ReturnLevel);this.dispatchEvent(t)},e.prototype.nextLevel=function(t){var e=this.level+1;this.levelChange(e),console.log("下一关关卡"+e)},e.prototype.gameTimer=function(){this.timer=new egret.Timer(this.time,this.timeNum),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this)},e.prototype.TxtTimer=function(){this.txt=new egret.TextField,this.txt.width=70,this.txt.height=50,this.txt.textAlign="center",this.txt.textColor=16777215,this.txt.size=30,this.txt.y=20,this.txt.x=20,this.addChild(this.txt)},e.prototype.timerFunc=function(){this.txt.text=this.timer.repeatCount-this.timer.currentCount+"S"},e.prototype.timerComFunc=function(){this.gameEnd()},e.prototype.gameEnd=function(){var t=this;this.removeEventListener(egret.Event.ENTER_FRAME,this.onGameLoop,this),this.scorePanel.showScore(this.delFish),this.addChild(this.scorePanel),this.clearFish(),this.fishEmitter.clearAll();try{setTimeout(function(){t.bannerAd.show()},1e3),console.log("显示广告")}catch(e){console.log(e)}},e.prototype.gameStart=function(){try{this.bannerAd.hide(),console.log("隐藏广告"),this.onCreateBannerAd(),console.log("重新拉取广告")}catch(t){console.log(t)}this.txt.text=this.timer.repeatCount+"S",this.timer.reset(),this.timer.start();try{this.removeChild(this.scorePanel)}catch(t){}this.addEventListener(egret.Event.ENTER_FRAME,this.onGameLoop,this)},e.prototype.onGameLoop=function(){var t=this;this.counter++%this.frequencyFish==0&&this.makeFish(),this.fishes.map(function(e){e.enabled&&(e.update(),e.render(),e.posY<-200&&t.removeFish(e))}),this.fishEmitter.update()},e.prototype.makeFish=function(){var t;if(this.spareFishes.length)t=this.spareFishes.pop(),t.enabled=!0,this.addChild(t);else{var e=this.createBitmapByName("orangefish0"+(this.fishes.length%4+1)+"_png");t=new Fish(0,0,0,e),this.fishes.push(t),t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.explodeFish,this),t.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.explodeFish,this),this.addChild(t)}var i=this.stage.stageWidth/2;t.posX=i+this.randomRange(-250,250),t.posY=this.stage.stageHeight+10,t.posZ=this.randomRange(-250,250),t.velX=this.randomRange(-1,1),t.velY=this.randomRange(-1,-2),t.velZ=this.randomRange(-1,1),t.size=1,t.gravity=this.gravity},e.prototype.explodeFish=function(t){var e=t.target;this.fishEmitter.makeExplosion(e.posX,e.posY),this.removeFish(e),this.delFish++},e.prototype.removeFish=function(t){t.enabled=!1,this.removeChild(t),this.spareFishes.push(t)},e.prototype.clearFish=function(){var t=this;this.delFish=0,this.counter=0,this.fishes.map(function(e){e.enabled&&t.removeFish(e)})},e.prototype.randomRange=function(t,e){return Math.random()*(e-t)+t},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.DisplayObjectContainer);__reflect(Game.prototype,"Game");var Level=function(t){function e(e,i){var n=t.call(this)||this;return n.isLock=!0,n.skinName="resource/skins/level.exml",n.isLock=e,n.number=i,n.width=n.level_lock.width,n.height=n.level_lock.height,n.render(),n.animateEvent(),n}return __extends(e,t),e.prototype.render=function(){this.isLock?(this.level_lock.visible=!0,this.level_unlock.visible=!1):(this.level_unlock.visible=!0,this.level_lock.visible=!1,this.level_id.source="number_"+this.number+"_png")},e.prototype.animateEvent=function(){var t=this;this.level_unlock.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.level.play(0)},this),this.level.addEventListener("complete",function(){var e=new CustomHandleEvent(CustomHandleEvent.ChoiceLevel);e.levelNum=t.number,t.dispatchEvent(e)},this),this.level_lock.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.lock.play(0)},this)},e}(eui.Component);__reflect(Level.prototype,"Level");var BgMap=function(t){function e(){var e=t.call(this)||this;return e.bgSpeed=20,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this);var t=this.stage.stageWidth,e=this.stage.stageHeight;this.textureHeight=e,this.rowCount=Math.ceil(e/this.textureHeight)+1,this.bmpParallaxBackArr=[],this.bmpParallaxFrontArr=[];for(var i=0;i<this.rowCount;i+=1){var n=this.createBitmapByName("parallaxBack_jpg");n.y=this.textureHeight*i-(this.textureHeight*this.rowCount-e),n.width=t,n.height=e,this.bmpParallaxBackArr.push(n),this.addChild(n)}for(var i=0;i<this.rowCount;i+=1){var s=this.createBitmapByName("parallaxFront_png");s.y=this.textureHeight*i-(this.textureHeight*this.rowCount-e),s.width=t,s.height=e,this.bmpParallaxFrontArr.push(s),this.addChild(s)}},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e.name=t,e},e.prototype.start=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this),this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},e.prototype.pause=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},e.prototype.enterFrameHandler=function(t){for(var e=0;e<this.rowCount;e+=1){var i=this.bmpParallaxFrontArr[e];i.y+=2*this.bgSpeed,i.y>this.stage.stageHeight&&(i.y=this.bmpParallaxFrontArr[0].y-this.textureHeight,this.bmpParallaxFrontArr.pop(),this.bmpParallaxFrontArr.unshift(i));var n=this.bmpParallaxBackArr[e];n.y+=this.bgSpeed,n.y>this.stage.stageHeight&&(n.y=this.bmpParallaxBackArr[0].y-this.textureHeight,this.bmpParallaxBackArr.pop(),this.bmpParallaxBackArr.unshift(n))}},e}(egret.DisplayObjectContainer);__reflect(BgMap.prototype,"BgMap");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e.skinName="resource/skins/loading.exml",e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField)},e.prototype.onProgress=function(t,e){this.loading.width=t/e*428},e}(eui.Component);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,5,,6]),egret.ImageLoader.crossOrigin="anonymous",[4,RES.loadConfig("default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("loading",1)];case 3:return i.sent(),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadGroup("preload",0,t)];case 4:return i.sent(),this.stage.removeChild(t),[3,6];case 5:return e=i.sent(),console.error(e),[3,6];case 6:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var n=new eui.Theme("resource/default.thm.json",t.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){this.addMap()},e.prototype.addMap=function(){this.addChild(new Map)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var Map=function(t){function e(){var e=t.call(this)||this;return e.touchStatus=!1,e.distance=new egret.Point,e.speedX=0,e.speedY=0,e.speed=15,e.paopaoFishBullets=[],e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.preCreatedBullet();var t=this,e="resource/assets/cc.tmx",i=new egret.URLLoader;i.dataFormat=egret.URLLoaderDataFormat.TEXT,i.load(new egret.URLRequest(e)),i.addEventListener(egret.Event.COMPLETE,function(i){var n=egret.XML.parse(i.target.data),s=new tiled.TMXTilemap(800,480,n,e);s.render(),t.addChild(s),t.addChild(s);var r=s.getChildByName("bomb");t.bomb(r);var r=s.getChildByName("bomb");t.bomb(r),t.setEnemyMap(s),t.setFish(),t.paopao(),t.setPaopaoyun(s),t.setVJ()},e)},e.prototype.setVJ=function(){this.vj=new VirtualJoystick,this.vj.x=this.vj.width/2,this.vj.y=this.stage.stageHeight-this.vj.height/2,this.addChild(this.vj),this.vj.start(),this.vj.addEventListener("vj_start",this.onVJStart,this),this.vj.addEventListener("vj_move",this.onVJChange,this),this.vj.addEventListener("vj_end",this.onVJEnd,this)},e.prototype.onVJStart=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},e.prototype.onVJChange=function(t){var e=t.data;this.speedX=Math.cos(e)*this.speed,this.speedY=Math.sin(e)*this.speed},e.prototype.onVJEnd=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},e.prototype.onEnterFrame=function(){this.paopaoFish.x+=this.speedX,this.paopaoFish.y+=this.speedY,this.paopaoFish.x>this.stage.stageWidth-this.paopaoFish.width/4&&(this.paopaoFish.x=this.stage.stageWidth-this.paopaoFish.width/4),this.paopaoFish.x<0&&(this.paopaoFish.x=0),this.paopaoFish.y<0&&(this.paopaoFish.y=0),this.paopaoFish.y>this.stage.stageHeight-this.paopaoFish.height/2&&(this.paopaoFish.y=this.stage.stageHeight-this.paopaoFish.height/2)},e.prototype.paopao=function(){var t=RES.getRes("paopaoParticle_png"),e=RES.getRes("paopaoParticle_json"),i=new particle.GravityParticleSystem(t,e);this.addChild(i),i.start(),setTimeout(function(){i.stop()},2e3)},e.prototype.setPaopaoyun=function(t){this.paopaoyun=new PaoPaoYun(t),this.addChild(this.paopaoyun),this.paopaoyun.start();this.paopaoyun.y},e.prototype.bomb=function(t){this.bombMap=new BombMap(t),this.addChild(this.bombMap)},e.prototype.setEnemyMap=function(t){this.enemyMap=new EnemyMap(t),this.addChild(this.enemyMap)},e.prototype.setFish=function(){var t=this.createBitmapByName("orangefish01_png");this.fish=new Fish(0,0,0,t),this.fish.scaleX=.3,this.fish.scaleY=.3,this.fish.touchEnabled=!0,this.fish.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.down,this),this.fish.addEventListener(egret.TouchEvent.TOUCH_END,this.up,this),this.addChild(this.fish),this.paopaoFish=new PaoPaoFish(RES.getRes("orangefish02_png"),100),this.paopaoFish.x=this.stage.stageWidth/2,this.paopaoFish.y=this.stage.stageHeight-this.paopaoFish.height/2,this.paopaoFish.scaleX=.4,this.paopaoFish.scaleY=.4,this.paopaoFish.addEventListener("createBullet",this.createBulletHandler,this),this.addChild(this.paopaoFish),this.paopaoFish.fire(),this.addEventListener(egret.Event.ENTER_FRAME,this.gameViewUpdate,this)},e.prototype.preCreatedBullet=function(){var t,e=0,i=[];for(e=0;20>e;e++)t=Bullet.make("paopao_png"),i.push(t);for(e=0;20>e;e++)t=i.pop(),Bullet.reclaim(t,"paopao_png")},e.prototype.createBulletHandler=function(t){var e;if(t.target===this.paopaoFish)for(var i=0;2>i;i++)e=Bullet.make("paopao_png"),e.x=0==i?this.paopaoFish.x+5:this.paopaoFish.x+.4*this.paopaoFish.width-20,e.y=this.paopaoFish.y-10,this.addChildAt(e,this.numChildren-1),this.paopaoFishBullets.push(e)},e.prototype.gameViewUpdate=function(t){var e=egret.getTimer(),i=1e3/(e-this._lastTime);this._lastTime=e;for(var n,s=60/i,r=0,o=this.paopaoFishBullets.length;o>r;r++)n=this.paopaoFishBullets[r],n.y<-n.height&&(this.removeChild(n),Bullet.reclaim(n,"ball_png"),this.paopaoFishBullets.splice(r,1),r--,o--),n.y-=12*s},e.prototype.down=function(t){this.touchStatus=!0,this.distance.x=t.stageX-this.fish.x,this.distance.y=t.stageY-this.fish.y,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.move,this)},e.prototype.up=function(t){this.touchStatus=!1,this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.move,this)},e.prototype.move=function(t){this.touchStatus&&(this.fish.x=t.stageX-this.distance.x,this.fish.y=t.stageY-this.distance.y,this.enemyMap.setTarget(this.fish.x,this.fish.y))},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e.name=t,e},e}(egret.DisplayObjectContainer);__reflect(Map.prototype,"Map");var PaoPaoFish=function(t){function e(e,i){var n=t.call(this)||this;return n.cachePool={},n.blood=10,n.fireDelay=i,n.bmp=new egret.Bitmap(e),n.addChild(n.bmp),n.fireTimer=new egret.Timer(n.fireDelay,0),n.fireTimer.addEventListener(egret.TimerEvent.TIMER,n.createBullet,n),n}return __extends(e,t),e.prototype.make=function(t,i){this.cachePool[t]||(this.cachePool[t]=[]);var n,s=this.cachePool[t];return n=s.length?s.pop():new e(RES.getRes(t),i)},e.prototype.reclaim=function(t,e){this.cachePool[e]||(this.cachePool[e]=[]);var i=this.cachePool[e];-1===i.indexOf(t)&&i.push(t)},e.prototype.fire=function(){this.fireTimer.start()},e.prototype.stopFire=function(){this.fireTimer.stop()},e.prototype.createBullet=function(){this.dispatchEventWith("createBullet")},e}(egret.DisplayObjectContainer);__reflect(PaoPaoFish.prototype,"PaoPaoFish");var PaoPaoYun=function(t){function e(e){var i=t.call(this)||this;return i.tmxTileMap=e,i.paopaoyun(),i}return __extends(e,t),e.prototype.paopaoyun=function(){var t=this,e=RES.getRes("paopaoParticle_png"),i=RES.getRes("paopaoyun_json");this.particleSys=new particle.GravityParticleSystem(e,i),console.log(this.particleSys);var n=this.tmxTileMap.getChildByName("paopaoyun"),s=n._childrens||[];s.map(function(e,i){if(0==i){var n=e.attributes;t.particleSys.x=0,t.particleSys.y=n.y-t.particleSys.emitterY-20,t.addChild(t.particleSys)}})},e.prototype.start=function(){this.particleSys.start()},e.prototype.stop=function(){this.particleSys.stop()},e}(egret.DisplayObjectContainer);__reflect(PaoPaoYun.prototype,"PaoPaoYun");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ScorePanel=function(t){function e(){var e=t.call(this)||this;return e.originNum=30,e.win=!1,e.render(),e}return __extends(e,t),e.prototype.render=function(){this.defautUI(),this.winUI()},e.prototype.defautUI=function(){this.tipView=new TipView,this.gameStartEvent=new CustomHandleEvent(CustomHandleEvent.GameStart),this.tipView.addEventListener(CustomHandleEvent.CompleteAnimation,this.gameStartHandle,this),this.tipView.addEventListener(CustomHandleEvent.ReturnLevelAnimation,this.returnLevel,this)},e.prototype.returnLevel=function(){var t=new CustomHandleEvent(CustomHandleEvent.ReturnLevel);this.dispatchEvent(t)},e.prototype.updateLevel=function(){var t=new CustomHandleEvent(CustomHandleEvent.UpdateLevel);this.dispatchEvent(t)},e.prototype.setOriginNum=function(t){void 0===t&&(t=30),this.originNum=t},e.prototype.showScore=function(t){var e="";if(t<this.originNum?(e="很遗憾，未达到目标！\n",this.win=!1):this.win=!0,this.win){this.updateLevel(),this.nextUI.enterAnimation(),this.addChild(this.nextUI);try{this.removeChild(this.tipView)}catch(i){}}else{try{this.removeChild(this.nextUI)}catch(i){}this.addChild(this.tipView),this.tipView.setText("您的成绩是："+t+"条\n\n"+e+"\n点击开始再来一次吧")}},e.prototype.showStart=function(){this.win=!1,this.tipView.setText("游戏开始后请滑破"+this.originNum+"条泡泡鱼\n\n点击开始吧");try{this.removeChild(this.nextUI),this.removeChild(this.tipView)}catch(t){}this.addChild(this.tipView)},e.prototype.gameStartHandle=function(){this.dispatchEvent(this.gameStartEvent)},e.prototype.winUI=function(){this.nextUI=new Win,this.nextUI.addEventListener(CustomHandleEvent.NextLevel,this.nextLevel,this),this.nextUI.addEventListener(CustomHandleEvent.ReturnLevelAnimation,this.returnLevel,this)},e.prototype.nextLevel=function(){var t=new CustomHandleEvent(CustomHandleEvent.NextLevel);this.dispatchEvent(t)},e}(egret.Sprite);__reflect(ScorePanel.prototype,"ScorePanel");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function s(t){e.call(n,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(n))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(n,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(n,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var a=t.split("/");a.pop();var h=a.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(n,generateJSON.paths[t])},this):RES.getResByUrl(h,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){e.call(n,generateJSON.paths[t])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(n,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var TipView=function(t){function e(){var e=t.call(this)||this;return e.isClick=!1,e.skinName="resource/skins/tip.exml",e.text.textAlign="center",e.text.textColor=16777215,e.text.size=24,e.text.y=100,e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=this,e=new CustomHandleEvent(CustomHandleEvent.CompleteAnimation),i=new CustomHandleEvent(CustomHandleEvent.ReturnLevelAnimation);this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.start.play(0)},this),this.start.addEventListener("complete",function(){t.dispatchEvent(e)},this),this.LevelList.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.returnLevel.play(0)},this),this.returnLevel.addEventListener("complete",function(){t.dispatchEvent(i)},this)},e.prototype.setText=function(t){this.text.text=t
},e}(eui.Component);__reflect(TipView.prototype,"TipView");var VirtualJoystick=function(t){function e(){var e=t.call(this)||this;return e.circleRadius=0,e.ballRadius=0,e.centerX=0,e.centerY=0,e.touchID=null,e.p1=new egret.Point,e.p2=new egret.Point,e.skinName="resource/skins/VirtualJoystickSkin.exml",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.circleRadius=this.circle.height/2,this.ballRadius=this.ball.height/2,this.centerX=this.circleRadius,this.centerY=this.circleRadius,this.anchorOffsetX=this.circleRadius,this.anchorOffsetY=this.circleRadius,this.ball.x=this.centerX,this.ball.y=this.centerY},e.prototype.start=function(){this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this)},e.prototype.stop=function(){this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this)},e.prototype.onTouchBegin=function(t){"ball"===t.target.name&&(this.touchID=t.touchPointID,this.dispatchEvent(new egret.Event("vj_start")))},e.prototype.onTouchEnd=function(t){this.touchID==t.touchPointID&&(this.touchID=null,this.dispatchEvent(new egret.Event("vj_end")))},e.prototype.onTouchMove=function(t){if(this.touchID==t.touchPointID){this.p1.x=this.x,this.p1.y=this.y,this.p2.x=t.stageX,this.p2.y=t.stageY;var e=egret.Point.distance(this.p1,this.p2),i=Math.atan2(t.stageY-this.y,t.stageX-this.x);e<=this.circleRadius-this.ballRadius?(this.ball.x=this.centerX+t.stageX-this.x,this.ball.y=this.centerY+t.stageY-this.y):(this.ball.x=Math.cos(i)*(this.circleRadius-this.ballRadius)+this.centerX,this.ball.y=Math.sin(i)*(this.circleRadius-this.ballRadius)+this.centerY),this.dispatchEventWith("vj_move",!1,i)}},e}(eui.Component);__reflect(VirtualJoystick.prototype,"VirtualJoystick");var Win=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/skins/win.exml",e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=this;this.next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.nextAnimation.play(0)},this),this.nextAnimation.addEventListener("complete",function(){var e=new CustomHandleEvent(CustomHandleEvent.NextLevel);t.dispatchEvent(e)},this),this.LevelList.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.returnLevel.play(0)},this),this.returnLevel.addEventListener("complete",function(){var e=new CustomHandleEvent(CustomHandleEvent.ReturnLevelAnimation);t.dispatchEvent(e)},this)},e.prototype.enterAnimation=function(){var t=this;this.winTextAnimation.play(0),this.winTextAnimation.addEventListener("complete",function(){t.nextShowAnimation.play(0)},this)},e}(eui.Component);__reflect(Win.prototype,"Win");var CustomHandleEvent=function(t){function e(e,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1);var s=t.call(this,e,i,n)||this;return s.levelNum=1,s}return __extends(e,t),e.GameStart="游戏开始",e.CompleteAnimation="按钮动画结束",e.ChoiceLevel="选择关卡",e.ReturnLevel="返回关卡",e.ReturnLevelAnimation="返回关卡",e.NextLevel="进入下一关",e.UpdateLevel="更新通关的关卡信息",e}(egret.Event);__reflect(CustomHandleEvent.prototype,"CustomHandleEvent");var fighter;!function(t){function e(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e.name=t,e}var i=function(){function t(){}return t.prototype.hitTest=function(t,e){var i=t.getBounds(),n=e.getBounds();return i.x=t.x,i.y=t.y,n.x=e.x,n.y=e.y,i.intersects(n)},t}();t.GameUtil=i,__reflect(i.prototype,"fighter.GameUtil"),t.createBitmapByName=e}(fighter||(fighter={}));