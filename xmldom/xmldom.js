var DOMParser=function(a){this.options=a||{locator:{}}};DOMParser.prototype.parseFromString=function(a,b){var d=this.options,c=new XMLReader,e=d.domBuilder||new DOMHandler,h=d.errorHandler,f=d.locator,g=d.xmlns||{},k={lt:"\x3c",gt:"\x3e",amp:"\x26",quot:'"',apos:"'"};f&&e.setDocumentLocator(f);c.errorHandler=buildErrorHandler(h,e,f);c.domBuilder=d.domBuilder||e;/\/x?html?$/.test(b)&&(k.nbsp="\u00a0",k.copy="\u00a9",g[""]="http://www.w3.org/1999/xhtml");g.xml=g.xml||"http://www.w3.org/XML/1998/namespace";a?c.parse(a,g,k):c.errorHandler.error("invalid doc source");return e.doc};function buildErrorHandler(a,b,d){function c(b){var c=a[b];!c&&h&&(c=2==a.length?function(c){a(b,c)}:a);e[b]=c&&function(a){c("[xmldom "+b+"]\t"+a+_locator(d))}||function(){}}if(!a){if(b instanceof DOMHandler)return b;a=b}var e={},h=a instanceof Function;d=d||{};c("warning");c("error");c("fatalError");return e}function DOMHandler(){this.cdata=!1}function position(a,b){b.lineNumber=a.lineNumber;b.columnNumber=a.columnNumber}DOMHandler.prototype={startDocument:function(){this.doc=(new DOMImplementation).createDocument(null,null,null);this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(a,b,d,c){var e=this.doc;b=e.createElementNS(a,d||b);var h=c.length;appendElement(this,b);this.currentElement=b;this.locator&&position(this.locator,b);for(var f=0;f<h;f++){a=c.getURI(f);var g=c.getValue(f);d=c.getQName(f);a=e.createAttributeNS(a,d);this.locator&&position(c.getLocator(f),a);a.value=a.nodeValue=g;b.setAttributeNode(a)}},endElement:function(a,b,d){this.currentElement=this.currentElement.parentNode},startPrefixMapping:function(a,b){},endPrefixMapping:function(a){},processingInstruction:function(a,b){var d=this.doc.createProcessingInstruction(a,b);this.locator&&position(this.locator,d);appendElement(this,d)},ignorableWhitespace:function(a,b,d){},characters:function(a,b,d){if(a=_toString.apply(this,arguments)){var c=this.cdata?this.doc.createCDATASection(a):this.doc.createTextNode(a);this.currentElement?this.currentElement.appendChild(c):/^\s*$/.test(a)&&this.doc.appendChild(c);this.locator&&position(this.locator,c)}},skippedEntity:function(a){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(a){if(this.locator=a)a.lineNumber=0},comment:function(a,b,d){a=_toString.apply(this,arguments);var c=this.doc.createComment(a);this.locator&&position(this.locator,c);appendElement(this,c)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(a,b,d){var c=this.doc.implementation;c&&c.createDocumentType&&(a=c.createDocumentType(a,b,d),this.locator&&position(this.locator,a),appendElement(this,a))},warning:function(a){console.warn("[xmldom warning]\t"+a,_locator(this.locator))},error:function(a){console.error("[xmldom error]\t"+a,_locator(this.locator))},fatalError:function(a){console.error("[xmldom fatalError]\t"+a,_locator(this.locator));throw a;}};function _locator(a){if(a)return"\n@"+(a.systemId||"")+"#[line:"+a.lineNumber+",col:"+a.columnNumber+"]"}function _toString(a,b,d){return"string"==typeof a?a.substr(b,d):a.length>=b+d||b?new java.lang.String(a,b,d)+"":a}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(a){DOMHandler.prototype[a]=function(){return null}});function appendElement(a,b){a.currentElement?a.currentElement.appendChild(b):a.doc.appendChild(b)}var XMLReader=require("./sax").XMLReader,DOMImplementation=exports.DOMImplementation=require("./dom").DOMImplementation;exports.XMLSerializer=require("./dom").XMLSerializer;exports.DOMParser=DOMParser;